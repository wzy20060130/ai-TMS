<script setup lang="ts">
import { ref, reactive } from 'vue'
import { Search, Refresh, Download, Plus } from '@element-plus/icons-vue'
import { ElMessage } from 'element-plus'

// ç»Ÿè®¡æ•°æ®
const stats = ref([
  {
    label: 'æ€»å¸æœºæ•°',
    value: 46,
    change: 'è¾ƒä¸Šæœˆ â†‘ 2',
    icon: 'ğŸšš',
    color: '#E3F2FD'
  },
  {
    label: 'ä»Šæ—¥åœ¨å²—',
    value: 28,
    change: 'å‡ºå‹¤ç‡ â†‘ 92%',
    icon: 'ğŸš›',
    color: '#E8F5E9'
  },
  {
    label: 'ç©ºé—²ä¸­',
    value: 10,
    change: 'è¾ƒæ˜¨æ—¥ â†“ 2',
    icon: 'ğŸ…¿ï¸',
    color: '#F3E5F5'
  },
  {
    label: 'ç©ºé—²',
    value: 5,
    change: 'è¾ƒæ˜¨æ—¥ â†‘ 1',
    icon: 'ğŸ“‹',
    color: '#FFF3E0'
  },
  {
    label: 'è¯ä»¶å³å°†åˆ°æœŸ',
    value: 8,
    change: 'è¾ƒä¸Šå‘¨å¢åŠ 3äºº',
    icon: 'âš ï¸',
    color: '#FFEBEE'
  }
])

// ç­›é€‰æ¡ä»¶
const filters = reactive({
  driverStatus: '',
  driverType: '',
  vehicleType: '',
  certificateStatus: '',
  workStatus: '',
  keyword: '',
  dateRange: []
})

// å¸æœºçŠ¶æ€é€‰é¡¹
const driverStatusOptions = [
  { label: 'å…¨éƒ¨', value: '' },
  { label: 'åœ¨å²—', value: '1' },
  { label: 'ä¼‘æ¯', value: '2' },
  { label: 'ç¦»èŒ', value: '3' }
]

// å¸æœºç±»å‹é€‰é¡¹
const driverTypeOptions = [
  { label: 'å…¨éƒ¨', value: '' },
  { label: 'ä¸“èŒå¸æœº', value: '1' },
  { label: 'å…¼èŒå¸æœº', value: '2' }
]

// è½¦è¾†ç±»å‹é€‰é¡¹
const vehicleTypeOptions = [
  { label: 'å…¨éƒ¨', value: '' },
  { label: 'å¢å¼è´§è½¦', value: '1' },
  { label: 'å¹³æ¿è½¦', value: '2' },
  { label: 'å†·è—è½¦', value: '3' }
]

// è¯ä»¶çŠ¶æ€é€‰é¡¹
const certificateStatusOptions = [
  { label: 'å…¨éƒ¨', value: '' },
  { label: 'æ­£å¸¸', value: '1' },
  { label: 'å³å°†åˆ°æœŸ', value: '2' },
  { label: 'å·²è¿‡æœŸ', value: '3' }
]

// å·¥ä½œçŠ¶æ€é€‰é¡¹
const workStatusOptions = [
  { label: 'å…¨éƒ¨', value: '' },
  { label: 'è¿è¾“ä¸­', value: '1' },
  { label: 'ç©ºé—²', value: '2' },
  { label: 'ä¼‘æ¯', value: '3' }
]

// å¸æœºåˆ—è¡¨
const driverList = ref([
  {
    id: 1,
    avatar: 'ğŸ‘¤',
    name: 'å¼ ä¸‰',
    driverId: '13912345678',
    idCard: '310102198XXXXXX',
    certificateType: 'å…¨éƒ¨',
    certificateTag: 'success',
    age: '12å¹´',
    fleet: 'å¿«é€’ä¸€é˜Ÿ',
    vehicle: 'æ²ªA-12345 å¢å¼è´§è½¦',
    vehicleTag: 'primary',
    status: 'åœ¨å²—',
    statusTag: 'success',
    workStatus: 'è¿è¾“ä¸­',
    workStatusTag: 'success',
    rating: 4.5,
    lastWorkTime: '2020-03-15 09:22',
    certExpireDate: '2023-05-10',
    actions: ['è¯¦æƒ…', 'ç¼–è¾‘']
  },
  {
    id: 2,
    avatar: 'ğŸ‘¤',
    name: 'æå››',
    driverId: '13987654321',
    idCard: '310102198XXXXXX',
    certificateType: 'å³å°†åˆ°æœŸ',
    certificateTag: 'warning',
    age: '-1å¹´',
    fleet: 'å¿«é€’äºŒé˜Ÿ',
    vehicle: 'æ²ªA-67890 å¢å¼è´§è½¦',
    vehicleTag: 'warning',
    status: 'ç©ºé—²',
    statusTag: 'info',
    workStatus: 'ç©ºé—²',
    workStatusTag: 'info',
    rating: 4.0,
    lastWorkTime: '2021-03-20 14:35',
    certExpireDate: '2023-05-11',
    actions: ['è¯¦æƒ…', 'ç¼–è¾‘']
  },
  {
    id: 3,
    avatar: 'ğŸ‘¤',
    name: 'ç‹äº”',
    driverId: '13812345678',
    idCard: '310103199XXXXXX',
    certificateType: 'å…¨éƒ¨',
    certificateTag: 'success',
    age: '-7å¹´',
    fleet: 'é•¿é€”è¿è¾“é˜Ÿ',
    vehicle: 'æ²ªA-54321 å†·è—è½¦',
    vehicleTag: 'success',
    status: 'ä¼‘æ¯',
    statusTag: 'warning',
    workStatus: 'ä¼‘æ¯',
    workStatusTag: 'warning',
    rating: 5.0,
    lastWorkTime: '2019-11-01 10:18',
    certExpireDate: '2023-09-09',
    actions: ['è¯¦æƒ…', 'ç¼–è¾‘']
  },
  {
    id: 4,
    avatar: 'ğŸ‘¤',
    name: 'èµµå…­',
    driverId: '13712345421',
    idCard: '310104199XXXXXX',
    certificateType: 'å·²è¿‡æœŸ',
    certificateTag: 'danger',
    age: '-5å¹´',
    fleet: 'å¿«é€’ä¸€é˜Ÿ',
    vehicle: 'æœ¬åœ°',
    vehicleTag: '',
    status: 'ä¼‘æ¯',
    statusTag: 'warning',
    workStatus: 'ä¼‘æ¯',
    workStatusTag: 'warning',
    rating: 3.0,
    lastWorkTime: '2022-01-18 16:42',
    certExpireDate: '2023-04-25',
    actions: ['è¯¦æƒ…', 'ç¼–è¾‘']
  },
  {
    id: 5,
    avatar: 'ğŸ‘¤',
    name: 'é’±ä¸ƒ',
    driverId: '13612345678',
    idCard: '310105199XXXXXX',
    certificateType: 'å…¨éƒ¨',
    certificateTag: 'success',
    age: '10å¹´',
    fleet: 'å¿«é€’ä¸€é˜Ÿ',
    vehicle: 'æœ¬åœ°',
    vehicleTag: '',
    status: 'åœ¨å²—',
    statusTag: 'success',
    workStatus: 'è¿è¾“ä¸­',
    workStatusTag: 'success',
    rating: 3.5,
    lastWorkTime: '2020-08-30 08:05',
    certExpireDate: '2023-05-05',
    actions: ['è¯¦æƒ…', 'ç¼–è¾‘']
  }
])

// åˆ†é¡µ
const pagination = ref({
  currentPage: 1,
  pageSize: 20,
  total: 1248
})

// æœç´¢
const handleSearch = () => {
  console.log('æœç´¢', filters)
  ElMessage.success('æœç´¢å®Œæˆ')
}

// é‡ç½®
const handleReset = () => {
  Object.assign(filters, {
    driverStatus: '',
    driverType: '',
    vehicleType: '',
    certificateStatus: '',
    workStatus: '',
    keyword: '',
    dateRange: []
  })
}

// å¯¼å‡º
const handleExport = () => {
  ElMessage.success('æ­£åœ¨å¯¼å‡ºæ•°æ®...')
}

// æ–°å¢å¸æœº
const handleAdd = () => {
  ElMessage.info('è·³è½¬åˆ°æ–°å¢å¸æœºé¡µé¢')
}

// æŸ¥çœ‹è¯¦æƒ…
const handleView = (row: any) => {
  console.log('æŸ¥çœ‹è¯¦æƒ…', row)
}

// ç¼–è¾‘
const handleEdit = (row: any) => {
  console.log('ç¼–è¾‘', row)
}

// åˆ†é¡µæ”¹å˜
const handlePageChange = (page: number) => {
  pagination.value.currentPage = page
}

const handleSizeChange = (size: number) => {
  pagination.value.pageSize = size
}
</script>

<template>
  <div class="driver-container">
    <!-- é¡¶éƒ¨ç»Ÿè®¡å¡ç‰‡ -->
    <div class="stats-grid">
      <div 
        v-for="(stat, index) in stats" 
        :key="index"
        class="stat-card"
        :style="{ backgroundColor: stat.color }"
      >
        <div class="stat-icon">{{ stat.icon }}</div>
        <div class="stat-content">
          <div class="stat-label">{{ stat.label }}</div>
          <div class="stat-value">{{ stat.value }}</div>
          <div class="stat-change">{{ stat.change }}</div>
        </div>
      </div>
    </div>

    <!-- ç­›é€‰åŒºåŸŸ -->
    <div class="filter-card">
      <div class="filter-row">
        <div class="filter-item">
          <label class="filter-label">å¸æœºçŠ¶æ€</label>
          <el-select v-model="filters.driverStatus" placeholder="å…¨éƒ¨" clearable>
            <el-option
              v-for="item in driverStatusOptions"
              :key="item.value"
              :label="item.label"
              :value="item.value"
            />
          </el-select>
        </div>

        <div class="filter-item">
          <label class="filter-label">å¸æœºç±»å‹</label>
          <el-select v-model="filters.driverType" placeholder="å…¨éƒ¨" clearable>
            <el-option
              v-for="item in driverTypeOptions"
              :key="item.value"
              :label="item.label"
              :value="item.value"
            />
          </el-select>
        </div>

        <div class="filter-item">
          <label class="filter-label">è½¦è¾†ç±»å‹/è§„æ ¼</label>
          <el-select v-model="filters.vehicleType" placeholder="å…¨éƒ¨" clearable>
            <el-option
              v-for="item in vehicleTypeOptions"
              :key="item.value"
              :label="item.label"
              :value="item.value"
            />
          </el-select>
        </div>

        <div class="filter-item">
          <label class="filter-label">è¯ç…§çŠ¶æ€</label>
          <el-select v-model="filters.certificateStatus" placeholder="å…¨éƒ¨" clearable>
            <el-option
              v-for="item in certificateStatusOptions"
              :key="item.value"
              :label="item.label"
              :value="item.value"
            />
          </el-select>
        </div>

        <div class="filter-item">
          <label class="filter-label">æ‰€å±è½¦é˜Ÿ</label>
          <el-select v-model="filters.workStatus" placeholder="å…¨éƒ¨" clearable>
            <el-option
              v-for="item in workStatusOptions"
              :key="item.value"
              :label="item.label"
              :value="item.value"
            />
          </el-select>
        </div>

        <div class="filter-item">
          <label class="filter-label">ç›®çš„åœ°</label>
          <el-select v-model="filters.keyword" placeholder="å…¨éƒ¨" clearable>
            <el-option label="åŒ—äº¬" value="1" />
            <el-option label="ä¸Šæµ·" value="2" />
          </el-select>
        </div>

        <div class="filter-item">
          <label class="filter-label">æ—¶é—´</label>
          <el-date-picker
            v-model="filters.dateRange"
            type="daterange"
            range-separator="è‡³"
            start-placeholder="å¼€å§‹æ—¥æœŸ"
            end-placeholder="ç»“æŸæ—¥æœŸ"
          />
        </div>

        <div class="filter-actions">
          <el-button type="primary" :icon="Search" @click="handleSearch">æœç´¢</el-button>
          <el-button :icon="Refresh" @click="handleReset">é‡ç½®</el-button>
        </div>
      </div>

      <div class="keyword-search">
        <el-input
          v-model="filters.keyword"
          placeholder="è¯·è¾“å…¥å¸æœºå§“åã€æ‰‹æœºå·ç­‰å…³é”®è¯æœç´¢"
          clearable
          style="width: 400px"
        >
          <template #prefix>
            <el-icon><Search /></el-icon>
          </template>
        </el-input>
      </div>
    </div>

    <!-- æ“ä½œæ  -->
    <div class="toolbar">
      <div class="toolbar-left">
        <el-button type="danger" :icon="Plus" @click="handleAdd">æ–°å¢</el-button>
        <el-button type="primary" :icon="Download" @click="handleExport">å¯¼å‡º</el-button>
      </div>
      <div class="toolbar-right">
        <el-button text>åˆ·æ–°</el-button>
      </div>
    </div>

    <!-- å¸æœºåˆ—è¡¨ -->
    <div class="driver-table-card">
      <el-table :data="driverList" stripe style="width: 100%">
        <el-table-column type="selection" width="50" />
        
        <el-table-column label="å¸æœºä¿¡æ¯" width="180" fixed>
          <template #default="{ row }">
            <div class="driver-info">
              <div class="driver-avatar">{{ row.avatar }}</div>
              <div class="driver-detail">
                <div class="driver-name">{{ row.name }}</div>
                <div class="driver-id">{{ row.driverId }}</div>
              </div>
            </div>
          </template>
        </el-table-column>

        <el-table-column label="é©¾é©¶è¯ä¿¡æ¯" width="150">
          <template #default="{ row }">
            <div class="license-info">
              <div class="id-card">èº«ä»½è¯ï¼š{{ row.idCard }}</div>
              <div class="license-type">é©¾é©¶è¯ï¼š{{ row.idCard }}</div>
            </div>
          </template>
        </el-table-column>

        <el-table-column label="è¯ç…§" width="100">
          <template #default="{ row }">
            <el-tag :type="row.certificateTag" size="small">{{ row.certificateType }}</el-tag>
          </template>
        </el-table-column>

        <el-table-column label="é©¾é©¶å¹´é™" width="100">
          <template #default="{ row }">
            <div class="driving-years">{{ row.age }}</div>
          </template>
        </el-table-column>

        <el-table-column label="è½¦è¾†å½’å±" width="120">
          <template #default="{ row }">
            <div class="fleet">{{ row.fleet }}</div>
          </template>
        </el-table-column>

        <el-table-column label="å·¥ä½œçŠ¶æ€" width="150">
          <template #default="{ row }">
            <div class="work-status">
              <div class="vehicle-info">
                <el-tag v-if="row.vehicleTag" :type="row.vehicleTag" size="small">
                  {{ row.vehicle }}
                </el-tag>
                <span v-else class="vehicle-text">{{ row.vehicle }}</span>
              </div>
            </div>
          </template>
        </el-table-column>

        <el-table-column label="å¸æœºçŠ¶æ€" width="100">
          <template #default="{ row }">
            <el-tag :type="row.statusTag" size="small">{{ row.status }}</el-tag>
          </template>
        </el-table-column>

        <el-table-column label="æœ€è¿‘è¯„åˆ†" width="120">
          <template #default="{ row }">
            <div class="rating">
              <el-rate 
                v-model="row.rating" 
                disabled 
                show-score 
                text-color="#ff9900"
                score-template="{value}"
              />
            </div>
          </template>
        </el-table-column>

        <el-table-column label="æœ€æ–°ä»»åŠ¡æ—¶é—´" width="150">
          <template #default="{ row }">
            <div class="last-work-time">{{ row.lastWorkTime }}</div>
          </template>
        </el-table-column>

        <el-table-column label="æœ€è¿‘è¯ä»¶" width="120">
          <template #default="{ row }">
            <div class="cert-expire">{{ row.certExpireDate }}</div>
          </template>
        </el-table-column>

        <el-table-column label="æ“ä½œ" width="150" fixed="right">
          <template #default="{ row }">
            <el-button link type="primary" size="small" @click="handleView(row)">
              è¯¦æƒ…
            </el-button>
            <el-button link type="primary" size="small" @click="handleEdit(row)">
              ç¼–è¾‘
            </el-button>
          </template>
        </el-table-column>
      </el-table>

      <!-- åˆ†é¡µ -->
      <div class="pagination-wrapper">
        <el-pagination
          v-model:current-page="pagination.currentPage"
          v-model:page-size="pagination.pageSize"
          :page-sizes="[10, 20, 50, 100]"
          :total="pagination.total"
          layout="total, sizes, prev, pager, next, jumper"
          @size-change="handleSizeChange"
          @current-change="handlePageChange"
        />
      </div>
    </div>
  </div>
</template>

<style scoped>
.driver-container {
  padding: 0;
  background: #f8f9fa;
}

/* ç»Ÿè®¡å¡ç‰‡ */
.stats-grid {
  display: grid;
  grid-template-columns: repeat(5, 1fr);
  gap: 16px;
  margin-bottom: 16px;
}

.stat-card {
  background: white;
  border-radius: 8px;
  padding: 20px;
  display: flex;
  align-items: center;
  gap: 16px;
  box-shadow: 0 1px 3px rgba(0, 0, 0, 0.08);
  border: 1px solid #f0f0f0;
  transition: all 0.3s;
}

.stat-card:hover {
  transform: translateY(-2px);
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.12);
}

.stat-icon {
  font-size: 32px;
  width: 56px;
  height: 56px;
  display: flex;
  align-items: center;
  justify-content: center;
  background: rgba(255, 255, 255, 0.8);
  border-radius: 8px;
}

.stat-content {
  flex: 1;
}

.stat-label {
  font-size: 13px;
  color: #8c8c8c;
  margin-bottom: 6px;
}

.stat-value {
  font-size: 28px;
  font-weight: 600;
  color: #262626;
  margin-bottom: 4px;
}

.stat-change {
  font-size: 12px;
  color: #52c41a;
}

/* ç­›é€‰åŒºåŸŸ */
.filter-card {
  background: white;
  border-radius: 8px;
  padding: 20px;
  margin-bottom: 16px;
  box-shadow: 0 1px 3px rgba(0, 0, 0, 0.08);
  border: 1px solid #f0f0f0;
}

.filter-row {
  display: flex;
  flex-wrap: wrap;
  gap: 16px;
  align-items: flex-end;
  margin-bottom: 16px;
}

.filter-item {
  display: flex;
  flex-direction: column;
  gap: 8px;
}

.filter-label {
  font-size: 13px;
  color: #595959;
  font-weight: 500;
}

.filter-item :deep(.el-select),
.filter-item :deep(.el-input) {
  width: 160px;
}

.filter-item :deep(.el-date-editor) {
  width: 240px;
}

.filter-actions {
  display: flex;
  gap: 8px;
  margin-left: auto;
}

.keyword-search {
  padding-top: 16px;
  border-top: 1px solid #f0f0f0;
}

/* æ“ä½œæ  */
.toolbar {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 16px;
}

.toolbar-left,
.toolbar-right {
  display: flex;
  gap: 8px;
}

/* å¸æœºè¡¨æ ¼ */
.driver-table-card {
  background: white;
  border-radius: 8px;
  padding: 20px;
  box-shadow: 0 1px 3px rgba(0, 0, 0, 0.08);
  border: 1px solid #f0f0f0;
}

.driver-info {
  display: flex;
  align-items: center;
  gap: 12px;
}

.driver-avatar {
  width: 40px;
  height: 40px;
  border-radius: 50%;
  background: #e6f7ff;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 24px;
}

.driver-detail {
  display: flex;
  flex-direction: column;
  gap: 4px;
}

.driver-name {
  font-size: 14px;
  color: #262626;
  font-weight: 600;
}

.driver-id {
  font-size: 12px;
  color: #8c8c8c;
}

.license-info {
  display: flex;
  flex-direction: column;
  gap: 4px;
}

.id-card,
.license-type {
  font-size: 12px;
  color: #595959;
}

.driving-years {
  font-size: 13px;
  color: #262626;
}

.fleet {
  font-size: 13px;
  color: #595959;
}

.work-status {
  display: flex;
  flex-direction: column;
  gap: 4px;
}

.vehicle-info {
  font-size: 12px;
}

.vehicle-text {
  color: #595959;
}

.rating {
  display: flex;
  align-items: center;
}

.rating :deep(.el-rate) {
  height: 20px;
}

.rating :deep(.el-rate__icon) {
  font-size: 14px;
}

.rating :deep(.el-rate__text) {
  font-size: 12px;
  margin-left: 4px;
}

.last-work-time,
.cert-expire {
  font-size: 12px;
  color: #595959;
}

/* åˆ†é¡µ */
.pagination-wrapper {
  margin-top: 20px;
  display: flex;
  justify-content: flex-end;
}

:deep(.el-table) {
  font-size: 13px;
}

:deep(.el-table th) {
  background: #fafafa;
  color: #595959;
  font-weight: 600;
}

:deep(.el-table td) {
  padding: 12px 0;
}
</style>


