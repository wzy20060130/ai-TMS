<script setup lang="ts">
import { ref, reactive } from 'vue';
import { Search, Refresh, Download, Plus } from '@element-plus/icons-vue';
import { ElMessage } from 'element-plus';

// ÁªüËÆ°Êï∞ÊçÆ
const stats = ref([
  {
    label: 'ÊÄªËΩ¶ËæÜÊï∞',
    value: 46,
    change: 'ËæÉ‰∏äÊúà ‚Üë 2',
    icon: 'üöö',
    color: '#E3F2FD',
  },
  {
    label: 'ËøêË°å‰∏≠ËΩ¶ËæÜ',
    value: 28,
    change: 'ËæÉÊò®Êó•Â¢ûÂä†4ËæÜ',
    icon: 'üöõ',
    color: '#E8F5E9',
  },
  {
    label: 'Á©∫Èó≤ËΩ¶ËæÜ',
    value: 10,
    change: 'ËæÉÊò®Êó• ‚Üì 2',
    icon: 'üÖøÔ∏è',
    color: '#F3E5F5',
  },
  {
    label: '‰øùÂÖª‰∏≠ËΩ¶ËæÜ',
    value: 5,
    change: 'ËæÉÊò®Êó• ‚Üë 1ËæÜ',
    icon: 'üîß',
    color: '#FFF3E0',
  },
  {
    label: 'Êú¨ÊúàÁª¥‰øÆË¥π',
    value: 8,
    change: 'ËæÉÊò®Êó•Â¢ûÂä†Ë¥πÁî®',
    icon: 'üí∞',
    color: '#FFEBEE',
  },
]);

// Á≠õÈÄâÊù°‰ª∂
const filters = reactive({
  vehicleType: '',
  vehicleStatus: '',
  ownershipType: '',
  maintenanceStatus: '',
  driverStatus: '',
  dateRange: [],
  keyword: '',
});

// ËΩ¶ËæÜÁ±ªÂûãÈÄâÈ°π
const vehicleTypeOptions = [
  { label: 'ÂÖ®ÈÉ®', value: '' },
  { label: 'Âé¢ÂºèË¥ßËΩ¶', value: '1' },
  { label: 'Âπ≥ÊùøËΩ¶', value: '2' },
  { label: 'ÂÜ∑ËóèËΩ¶', value: '3' },
  { label: 'Âç±Èô©ÂìÅËΩ¶', value: '4' },
];

// ËΩ¶ËæÜÁä∂ÊÄÅÈÄâÈ°π
const vehicleStatusOptions = [
  { label: 'ÂÖ®ÈÉ®', value: '' },
  { label: 'ËøêË°å‰∏≠', value: '1' },
  { label: 'Á©∫Èó≤', value: '2' },
  { label: '‰øùÂÖª‰∏≠', value: '3' },
  { label: 'Áª¥‰øÆ‰∏≠', value: '4' },
];

// ÂΩíÂ±ûÁ±ªÂûãÈÄâÈ°π
const ownershipTypeOptions = [
  { label: 'ÂÖ®ÈÉ®', value: '' },
  { label: 'Ëá™ÊúâËΩ¶ËæÜ', value: '1' },
  { label: 'Â§ñÂçèËΩ¶ËæÜ', value: '2' },
];

// ‰øùÂÖªÁä∂ÊÄÅÈÄâÈ°π
const maintenanceStatusOptions = [
  { label: 'ÂÖ®ÈÉ®', value: '' },
  { label: 'Ê≠£Â∏∏', value: '1' },
  { label: 'Âç≥Â∞Ü‰øùÂÖª', value: '2' },
  { label: '‰øùÂÖª‰∏≠', value: '3' },
];

// ËΩ¶ËæÜÂàóË°®
const vehicleList = ref([
  {
    id: 1,
    plateNumber: 'Ê≤™A-12345',
    vehicleType: 'Âé¢ÂºèË¥ßËΩ¶',
    vehicleInfo: {
      brand: 'Á¶èÁî∞Ê¨ßÈ©¨ÂèØS3',
      model: '4.2Á±≥',
      load: '3000kg',
      volume: '18m¬≥',
    },
    ownership: 'Ëá™Êúâ',
    driver: {
      name: 'Âº†Â∏àÂÇÖ',
      phone: '138****1234',
      avatar: 'üë§',
    },
    status: 'ËøêË°å‰∏≠',
    statusType: 'success',
    currentOrder: 'PLAN-2023062001',
    mileage: '126,854 km',
    lastMaintenance: '2023-06-21',
    nextMaintenance: '2024-05-15',
    maintenanceStatus: 'Ê≠£Â∏∏',
  },
  {
    id: 2,
    plateNumber: 'Á≤§A-67890',
    vehicleType: 'ÂÜ∑ËóèËΩ¶',
    vehicleInfo: {
      brand: 'Ëß£ÊîæJ6',
      model: '6.8Á±≥',
      load: '8000kg',
      volume: '35m¬≥',
    },
    ownership: 'Ëá™Êúâ',
    driver: {
      name: 'ÊùéÂ∏àÂÇÖ',
      phone: '139****5678',
      avatar: 'üë§',
    },
    status: 'ËøêË°å‰∏≠',
    statusType: 'success',
    currentOrder: 'PLAN-2023062002',
    mileage: '89,452 km',
    lastMaintenance: '2023-06-26 (5Â§©Ââç)',
    nextMaintenance: '2024-05-20',
    maintenanceStatus: 'Ê≠£Â∏∏',
  },
  {
    id: 3,
    plateNumber: '‰∫¨A-24680',
    vehicleType: 'ÂÜ∑ËóèËΩ¶',
    vehicleInfo: {
      brand: '‰∏úÈ£éÂ§©Èî¶',
      model: '7.6Á±≥',
      load: '10000kg',
      volume: '42m¬≥',
    },
    ownership: 'Â§ñÂçè',
    driver: {
      name: 'ÁéãÂ∏àÂÇÖ',
      phone: '136****9012',
      avatar: 'üë§',
    },
    status: 'Á©∫Èó≤',
    statusType: 'info',
    currentOrder: '-',
    mileage: '65,321 km',
    lastMaintenance: '2023-06-24 (3Â§©Ââç)',
    nextMaintenance: '2024-01-10',
    maintenanceStatus: 'Ê≠£Â∏∏',
  },
]);

// ÂàÜÈ°µ
const pagination = ref({
  currentPage: 1,
  pageSize: 20,
  total: 1248,
});

// ÊêúÁ¥¢
const handleSearch = () => {
  // TODO: ÂÆûÁé∞ÊêúÁ¥¢ÈÄªËæë
  ElMessage.success('ÊêúÁ¥¢ÂÆåÊàê');
};

// ÈáçÁΩÆ
const handleReset = () => {
  Object.assign(filters, {
    vehicleType: '',
    vehicleStatus: '',
    ownershipType: '',
    maintenanceStatus: '',
    driverStatus: '',
    dateRange: [],
    keyword: '',
  });
};

// ÂØºÂá∫
const handleExport = () => {
  ElMessage.success('Ê≠£Âú®ÂØºÂá∫Êï∞ÊçÆ...');
};

// Êñ∞Â¢ûËΩ¶ËæÜ
const handleAdd = () => {
  ElMessage.info('Ë∑≥ËΩ¨Âà∞Êñ∞Â¢ûËΩ¶ËæÜÈ°µÈù¢');
};

// Êü•ÁúãËØ¶ÊÉÖ
interface VehicleRow {
  id: number;
  [key: string]: unknown;
}
const handleView = (_row: VehicleRow) => {
  // TODO: ÂÆûÁé∞Êü•ÁúãËØ¶ÊÉÖÈÄªËæë
};

// ÁºñËæë
const handleEdit = (_row: VehicleRow) => {
  // TODO: ÂÆûÁé∞ÁºñËæëÈÄªËæë
};

// ‰øùÂÖªËÆ∞ÂΩï
const handleMaintenance = (_row: VehicleRow) => {
  // TODO: ÂÆûÁé∞Êü•Áúã‰øùÂÖªËÆ∞ÂΩïÈÄªËæë
};

// ÂàÜÈ°µÊîπÂèò
const handlePageChange = (page: number) => {
  pagination.value.currentPage = page;
};

const handleSizeChange = (size: number) => {
  pagination.value.pageSize = size;
};
</script>

<template>
  <div class="vehicle-container">
    <!-- È°∂ÈÉ®ÁªüËÆ°Âç°Áâá -->
    <div class="stats-grid">
      <div
        v-for="(stat, index) in stats"
        :key="index"
        class="stat-card"
        :style="{ backgroundColor: stat.color }"
      >
        <div class="stat-icon">{{ stat.icon }}</div>
        <div class="stat-content">
          <div class="stat-label">{{ stat.label }}</div>
          <div class="stat-value">{{ stat.value }}</div>
          <div class="stat-change">{{ stat.change }}</div>
        </div>
      </div>
    </div>

    <!-- Á≠õÈÄâÂå∫Âüü -->
    <div class="filter-card">
      <div class="filter-row">
        <div class="filter-item">
          <label class="filter-label">ËΩ¶ËæÜÁ±ªÂûã</label>
          <ElSelect v-model="filters.vehicleType" placeholder="ÂÖ®ÈÉ®" clearable>
            <ElOption
              v-for="item in vehicleTypeOptions"
              :key="item.value"
              :label="item.label"
              :value="item.value"
            />
          </ElSelect>
        </div>

        <div class="filter-item">
          <label class="filter-label">ËΩ¶ËæÜÁä∂ÊÄÅ</label>
          <ElSelect v-model="filters.vehicleStatus" placeholder="ÂÖ®ÈÉ®" clearable>
            <ElOption
              v-for="item in vehicleStatusOptions"
              :key="item.value"
              :label="item.label"
              :value="item.value"
            />
          </ElSelect>
        </div>

        <div class="filter-item">
          <label class="filter-label">ËΩ¶ËæÜÂΩíÂ±û</label>
          <ElSelect v-model="filters.ownershipType" placeholder="ÂÖ®ÈÉ®" clearable>
            <ElOption
              v-for="item in ownershipTypeOptions"
              :key="item.value"
              :label="item.label"
              :value="item.value"
            />
          </ElSelect>
        </div>

        <div class="filter-item">
          <label class="filter-label">‰øùÂÖªÁä∂ÊÄÅ</label>
          <ElSelect v-model="filters.maintenanceStatus" placeholder="ÂÖ®ÈÉ®" clearable>
            <ElOption
              v-for="item in maintenanceStatusOptions"
              :key="item.value"
              :label="item.label"
              :value="item.value"
            />
          </ElSelect>
        </div>

        <div class="filter-item">
          <label class="filter-label">Âè∏Êú∫Áä∂ÊÄÅ</label>
          <ElSelect v-model="filters.driverStatus" placeholder="ÂÖ®ÈÉ®" clearable>
            <ElOption label="Âú®Â≤ó" value="1" />
            <ElOption label="‰ºëÊÅØ" value="2" />
          </ElSelect>
        </div>

        <div class="filter-item">
          <label class="filter-label">Êó∂Èó¥</label>
          <ElDatePicker
            v-model="filters.dateRange"
            type="daterange"
            range-separator="Ëá≥"
            start-placeholder="ÂºÄÂßãÊó•Êúü"
            end-placeholder="ÁªìÊùüÊó•Êúü"
          />
        </div>

        <div class="filter-actions">
          <ElButton type="primary" :icon="Search" @click="handleSearch">ÊêúÁ¥¢</ElButton>
          <ElButton :icon="Refresh" @click="handleReset">ÈáçÁΩÆ</ElButton>
        </div>
      </div>

      <div class="keyword-search">
        <ElInput
          v-model="filters.keyword"
          placeholder="ËØ∑ËæìÂÖ•ËΩ¶ÁâåÂè∑„ÄÅÂè∏Êú∫ÂßìÂêçÁ≠âÂÖ≥ÈîÆËØçÊêúÁ¥¢"
          clearable
          style="width: 400px"
        >
          <template #prefix>
            <ElIcon><Search /></ElIcon>
          </template>
        </ElInput>
      </div>
    </div>

    <!-- Êìç‰ΩúÊ†è -->
    <div class="toolbar">
      <div class="toolbar-left">
        <ElButton type="danger" :icon="Plus" @click="handleAdd">Êñ∞Â¢û</ElButton>
        <ElButton type="primary" :icon="Download" @click="handleExport">ÂØºÂá∫</ElButton>
      </div>
      <div class="toolbar-right">
        <ElButton text>Âà∑Êñ∞</ElButton>
      </div>
    </div>

    <!-- ËΩ¶ËæÜÂàóË°® -->
    <div class="vehicle-table-card">
      <ElTable :data="vehicleList" stripe style="width: 100%">
        <ElTableColumn type="selection" width="50" />

        <ElTableColumn label="ËΩ¶ÁâåÂè∑" width="120" fixed>
          <template #default="{ row }">
            <div class="plate-number">{{ row.plateNumber }}</div>
          </template>
        </ElTableColumn>

        <ElTableColumn label="ËΩ¶ËæÜÂûãÂè∑" width="150">
          <template #default="{ row }">
            <div class="vehicle-type">{{ row.vehicleType }}</div>
          </template>
        </ElTableColumn>

        <ElTableColumn label="ËΩ¶ËæÜ‰ø°ÊÅØ" width="200">
          <template #default="{ row }">
            <div class="vehicle-info">
              <div class="info-row">ÂìÅÁâåÔºö{{ row.vehicleInfo.brand }}</div>
              <div class="info-row">
                ËßÑÊ†ºÔºö{{ row.vehicleInfo.model }} | ËΩΩÈáçÔºö{{ row.vehicleInfo.load }}
              </div>
              <div class="info-row">ÂÆπÁßØÔºö{{ row.vehicleInfo.volume }}</div>
            </div>
          </template>
        </ElTableColumn>

        <ElTableColumn label="ÂΩíÂ±û‰ø°ÊÅØ" width="100">
          <template #default="{ row }">
            <ElTag :type="row.ownership === 'Ëá™Êúâ' ? 'success' : 'info'" size="small">
              {{ row.ownership }}
            </ElTag>
          </template>
        </ElTableColumn>

        <ElTableColumn label="ÂΩìÂâçÁä∂ÊÄÅ" width="100">
          <template #default="{ row }">
            <ElTag :type="row.statusType" size="small">{{ row.status }}</ElTag>
          </template>
        </ElTableColumn>

        <ElTableColumn label="ÂΩìÂâçÂè∏Êú∫" width="150">
          <template #default="{ row }">
            <div class="driver-info">
              <div class="driver-avatar">{{ row.driver.avatar }}</div>
              <div class="driver-detail">
                <div class="driver-name">{{ row.driver.name }}</div>
                <div class="driver-phone">{{ row.driver.phone }}</div>
              </div>
            </div>
          </template>
        </ElTableColumn>

        <ElTableColumn label="ÂΩìÂâçËøêÂçï/Áä∂ÊÄÅ" width="180">
          <template #default="{ row }">
            <div class="current-order">{{ row.currentOrder }}</div>
          </template>
        </ElTableColumn>

        <ElTableColumn label="‰∏ãÊ¨°‰øùÂÖª" width="150">
          <template #default="{ row }">
            <div class="maintenance-info">
              <div class="maintenance-date">{{ row.nextMaintenance }}</div>
            </div>
          </template>
        </ElTableColumn>

        <ElTableColumn label="ËΩ¶ËæÜ‰øùÂÖªÊÉÖÂÜµ" width="180">
          <template #default="{ row }">
            <div class="maintenance-status">
              <div class="status-text">{{ row.maintenanceStatus }}</div>
              <div class="last-maintenance">‰∏äÊ¨°Ôºö{{ row.lastMaintenance }}</div>
            </div>
          </template>
        </ElTableColumn>

        <ElTableColumn label="Êìç‰Ωú" width="200" fixed="right">
          <template #default="{ row }">
            <ElButton link type="primary" size="small" @click="handleView(row)"> ËØ¶ÊÉÖ </ElButton>
            <ElButton link type="primary" size="small" @click="handleEdit(row)"> ÁºñËæë </ElButton>
            <ElButton link type="primary" size="small" @click="handleMaintenance(row)">
              ‰øùÂÖªËÆ∞ÂΩï
            </ElButton>
          </template>
        </ElTableColumn>
      </ElTable>

      <!-- ÂàÜÈ°µ -->
      <div class="pagination-wrapper">
        <ElPagination
          v-model:current-page="pagination.currentPage"
          v-model:page-size="pagination.pageSize"
          :page-sizes="[10, 20, 50, 100]"
          :total="pagination.total"
          layout="total, sizes, prev, pager, next, jumper"
          @size-change="handleSizeChange"
          @current-change="handlePageChange"
        />
      </div>
    </div>
  </div>
</template>

<style scoped>
.vehicle-container {
  padding: 0;
  background: #f8f9fa;
}

/* ÁªüËÆ°Âç°Áâá */
.stats-grid {
  display: grid;
  grid-template-columns: repeat(5, 1fr);
  gap: 16px;
  margin-bottom: 16px;
}

.stat-card {
  background: white;
  border-radius: 8px;
  padding: 20px;
  display: flex;
  align-items: center;
  gap: 16px;
  box-shadow: 0 1px 3px rgba(0, 0, 0, 0.08);
  border: 1px solid #f0f0f0;
  transition: all 0.3s;
}

.stat-card:hover {
  transform: translateY(-2px);
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.12);
}

.stat-icon {
  font-size: 32px;
  width: 56px;
  height: 56px;
  display: flex;
  align-items: center;
  justify-content: center;
  background: rgba(255, 255, 255, 0.8);
  border-radius: 8px;
}

.stat-content {
  flex: 1;
}

.stat-label {
  font-size: 13px;
  color: #8c8c8c;
  margin-bottom: 6px;
}

.stat-value {
  font-size: 28px;
  font-weight: 600;
  color: #262626;
  margin-bottom: 4px;
}

.stat-change {
  font-size: 12px;
  color: #52c41a;
}

/* Á≠õÈÄâÂå∫Âüü */
.filter-card {
  background: white;
  border-radius: 8px;
  padding: 20px;
  margin-bottom: 16px;
  box-shadow: 0 1px 3px rgba(0, 0, 0, 0.08);
  border: 1px solid #f0f0f0;
}

.filter-row {
  display: flex;
  flex-wrap: wrap;
  gap: 16px;
  align-items: flex-end;
  margin-bottom: 16px;
}

.filter-item {
  display: flex;
  flex-direction: column;
  gap: 8px;
}

.filter-label {
  font-size: 13px;
  color: #595959;
  font-weight: 500;
}

.filter-item :deep(.el-select) {
  width: 160px;
}

.filter-actions {
  display: flex;
  gap: 8px;
  margin-left: auto;
}

.keyword-search {
  padding-top: 16px;
  border-top: 1px solid #f0f0f0;
}

/* Êìç‰ΩúÊ†è */
.toolbar {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 16px;
}

.toolbar-left,
.toolbar-right {
  display: flex;
  gap: 8px;
}

/* ËΩ¶ËæÜË°®Ê†º */
.vehicle-table-card {
  background: white;
  border-radius: 8px;
  padding: 20px;
  box-shadow: 0 1px 3px rgba(0, 0, 0, 0.08);
  border: 1px solid #f0f0f0;
}

.plate-number {
  font-size: 14px;
  font-weight: 600;
  color: #1890ff;
  cursor: pointer;
}

.plate-number:hover {
  text-decoration: underline;
}

.vehicle-type {
  font-size: 13px;
  color: #262626;
}

.vehicle-info {
  display: flex;
  flex-direction: column;
  gap: 4px;
}

.info-row {
  font-size: 12px;
  color: #595959;
}

.driver-info {
  display: flex;
  align-items: center;
  gap: 10px;
}

.driver-avatar {
  width: 32px;
  height: 32px;
  border-radius: 50%;
  background: #e6f7ff;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 18px;
}

.driver-detail {
  display: flex;
  flex-direction: column;
  gap: 2px;
}

.driver-name {
  font-size: 12px;
  color: #262626;
  font-weight: 500;
}

.driver-phone {
  font-size: 11px;
  color: #8c8c8c;
}

.current-order {
  font-size: 12px;
  color: #595959;
}

.maintenance-info {
  display: flex;
  flex-direction: column;
  gap: 4px;
}

.maintenance-date {
  font-size: 12px;
  color: #262626;
}

.maintenance-status {
  display: flex;
  flex-direction: column;
  gap: 4px;
}

.status-text {
  font-size: 12px;
  color: #262626;
  font-weight: 500;
}

.last-maintenance {
  font-size: 11px;
  color: #8c8c8c;
}

/* ÂàÜÈ°µ */
.pagination-wrapper {
  margin-top: 20px;
  display: flex;
  justify-content: flex-end;
}

:deep(.el-table) {
  font-size: 13px;
}

:deep(.el-table th) {
  background: #fafafa;
  color: #595959;
  font-weight: 600;
}

:deep(.el-table td) {
  padding: 12px 0;
}
</style>
